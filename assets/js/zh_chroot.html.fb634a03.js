"use strict";(self.webpackChunkruri=self.webpackChunkruri||[]).push([[18],{400:(a,n,s)=>{s.r(n),s.d(n,{comp:()=>t,data:()=>o});var e=s(89);const c={},t=(0,s(336).A)(c,[["render",function(a,n){return(0,e.uX)(),(0,e.CE)("div",null,[...n[0]||(n[0]=[(0,e.Fv)('<h1 id="chroot" tabindex="-1"><a class="header-anchor" href="#chroot"><span>Chroot</span></a></h1><p>Chroot 代表“change root”（更改根目录）。它被引入 Unix 系统，用于更改正在运行的进程及其子进程的表观根目录。与 Windows 使用 C:\\ 或 D:\\ 等驱动器号不同，Linux 只有一个单一的根目录 <code>/</code>，所有文件系统都挂载在其下方。当进程访问绝对路径时，它总是从 <code>/</code> 开始。</p><p>通过 chroot，你可以为进程更改根目录，将其视图和访问权限限制在新根目录下的文件和目录中。这种隔离是 Linux 容器的一个关键特性。</p><p>例如 <code>cat</code> 程序，它链接到几个库：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">linux-vdso.so.1 (0x0000ffffaba1f000)</span>\n<span class="line">libc.so.6 =&gt; /lib/aarch64-linux-gnu/libc.so.6 (0x0000ffffab7e0000)</span>\n<span class="line">/lib/ld-linux-aarch64.so.1 (0x0000ffffab9d0000)</span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（*vdso 是内核提供的一个虚拟动态共享对象。）</p><p>如果你在主机系统上运行 <code>cat</code>，它会从 <code>/lib/aarch64-linux-gnu/libc.so.6</code> 和 <code>/lib/ld-linux-aarch64.so.1</code> 加载这些库。如果这些库与 <code>cat</code> 期望的版本不匹配，它可能无法正常运行。然而，在 chroot 环境中，<code>cat</code> 只能看到并加载新根目录下的库，完全不受主机库的影响。</p><p>这就是为什么你可以在具有不同发行版的主机上运行 Debian、Alpine 或 Arch Linux 等容器，甚至在 Android 设备上运行 Linux 容器。从本质上讲，chroot 使整个根文件系统像一个“静态链接”的环境，从而确保兼容性和隔离性。</p><h1 id="chroot-系统调用" tabindex="-1"><a class="header-anchor" href="#chroot-系统调用"><span>chroot 系统调用</span></a></h1><p>chroot() 系统调用将调用进程的根目录更改为指定的路径。它被设计为仅在具有超级用户权限的情况下运行（这真的更安全吗？）。但如今，你也可以在用户命名空间中使用它，这允许非特权用户创建隔离环境。</p><p>使用起来非常简单，例如：</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">// 包含必要的头文件。</span></span>\n<span class="line"><span class="token function">chroot</span><span class="token punctuation">(</span><span class="token string">&quot;/new_root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token function">execv</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><strong>注意</strong>：本文档尚未完全翻译。欢迎贡献翻译！<br><strong>提示</strong>：本翻译由 Grok（xAI）大模型提供。</p>',14)])])}]]),o=JSON.parse('{"path":"/zh/chroot.html","title":"Chroot","lang":"zh-CN","frontmatter":{},"headers":[],"git":{"updatedTime":1762622740000,"contributors":[{"name":"Aqnya","username":"Aqnya","email":"siyueba73@gmail.com","commits":6,"url":"https://github.com/Aqnya"}],"changelog":[{"hash":"6d2a977f1d1572d54738fda359ddd43c259c94dd","time":1762622740000,"email":"siyueba73@gmail.com","author":"Aqnya","message":"up i18n"},{"hash":"07cc4a300e13de1b38bece7143fffaaf28b59960","time":1762621981000,"email":"siyueba73@gmail.com","author":"Aqnya","message":"up i18n"},{"hash":"5dc41b3a8e23bb0b4b0c6f8a89411c78541af36e","time":1762621688000,"email":"siyueba73@gmail.com","author":"Aqnya","message":"up i18n"},{"hash":"6a77a1065c79df7e7c281794608e494e7b19ed3e","time":1762621526000,"email":"siyueba73@gmail.com","author":"Aqnya","message":"up i18n"},{"hash":"ca06119589e284d4eb56c4fddb9ea813cc0ead1b","time":1762621274000,"email":"siyueba73@gmail.com","author":"Aqnya","message":"up i18n"},{"hash":"0f6b959c90ecf12ae03f5376c41ce98153623c38","time":1762617927000,"email":"siyueba73@gmail.com","author":"Aqnya","message":"add i18n support."}]},"filePathRelative":"zh/chroot.md"}')}}]);